# SK-Ana Docker Build and Run Script
# ===================================\n# This script builds the updated SK-Ana image with Correction Spectra support\n# and runs it as a container\n\n$ErrorActionPreference = \"Stop\"\n\n# Configuration\n$IMAGE_NAME = \"skana-update\"\n$IMAGE_TAG = \"latest\"\n$CONTAINER_NAME = \"skana\"\n$PORT = 3840\n$DOCKERFILE = \"Dockerfile.update\"\n\nWrite-Host \"========================================\" -ForegroundColor Cyan\nWrite-Host \"SK-Ana Docker Build and Run\" -ForegroundColor Cyan\nWrite-Host \"========================================\" -ForegroundColor Cyan\nWrite-Host \"\"\n\n# Step 1: Check if Docker is running\nWrite-Host \"[1/5] Checking Docker daemon...\" -ForegroundColor Yellow\ntry {\n    $dockerInfo = docker info 2>$null\n    if ($LASTEXITCODE -ne 0) {\n        throw \"Docker daemon not running\"\n    }\n    Write-Host \"  ✓ Docker is running\" -ForegroundColor Green\n} catch {\n    Write-Host \"  ✗ Error: Docker daemon is not running\" -ForegroundColor Red\n    Write-Host \"  Please start Docker Desktop and try again\" -ForegroundColor Red\n    exit 1\n}\n\n# Step 2: Stop and remove existing container if it exists\nWrite-Host \"\" \nWrite-Host \"[2/5] Checking for existing container...\" -ForegroundColor Yellow\n$existingContainer = docker ps -a --filter \"name=$CONTAINER_NAME\" --format \"{{.Names}}\" 2>$null\nif ($existingContainer -eq $CONTAINER_NAME) {\n    Write-Host \"  Found existing container: $CONTAINER_NAME\" -ForegroundColor Yellow\n    Write-Host \"  Stopping container...\" -ForegroundColor Yellow\n    docker stop $CONTAINER_NAME 2>$null | Out-Null\n    Write-Host \"  Removing container...\" -ForegroundColor Yellow\n    docker rm $CONTAINER_NAME 2>$null | Out-Null\n    Write-Host \"  ✓ Container removed\" -ForegroundColor Green\n} else {\n    Write-Host \"  ✓ No existing container found\" -ForegroundColor Green\n}\n\n# Step 3: Build the Docker image\nWrite-Host \"\"\nWrite-Host \"[3/5] Building Docker image...\" -ForegroundColor Yellow\nWrite-Host \"  Image: $IMAGE_NAME:$IMAGE_TAG\"\nWrite-Host \"  Dockerfile: $DOCKERFILE\"\nWrite-Host \"  This may take a few minutes...\" -ForegroundColor Cyan\nWrite-Host \"\"\n\ntry {\n    docker build -t \"${IMAGE_NAME}:${IMAGE_TAG}\" -f $DOCKERFILE . 2>&1\n    if ($LASTEXITCODE -eq 0) {\n        Write-Host \"\"\n        Write-Host \"  ✓ Image built successfully\" -ForegroundColor Green\n    } else {\n        throw \"Build failed with exit code $LASTEXITCODE\"\n    }\n} catch {\n    Write-Host \"\"\n    Write-Host \"  ✗ Error: Failed to build image\" -ForegroundColor Red\n    Write-Host \"  $_\" -ForegroundColor Red\n    exit 1\n}\n\n# Step 4: Run the container\nWrite-Host \"\"\nWrite-Host \"[4/5] Starting container...\" -ForegroundColor Yellow\nWrite-Host \"  Container name: $CONTAINER_NAME\"\nWrite-Host \"  Port mapping: $PORT (local) -> 3840 (container)\"\nWrite-Host \"\"\n\ntry {\n    docker run -d -p \"${PORT}:3840\" --name $CONTAINER_NAME -e PORT=3840 \"${IMAGE_NAME}:${IMAGE_TAG}\" 2>&1\n    if ($LASTEXITCODE -eq 0) {\n        Write-Host \"  ✓ Container started successfully\" -ForegroundColor Green\n    } else {\n        throw \"Container start failed with exit code $LASTEXITCODE\"\n    }\n} catch {\n    Write-Host \"  ✗ Error: Failed to start container\" -ForegroundColor Red\n    Write-Host \"  $_\" -ForegroundColor Red\n    exit 1\n}\n\n# Step 5: Verify container is running\nWrite-Host \"\"\nWrite-Host \"[5/5] Verifying container...\" -ForegroundColor Yellow\nStart-Sleep -Seconds 2\n\n$runningContainer = docker ps --filter \"name=$CONTAINER_NAME\" --format \"{{.Names}}\" 2>$null\nif ($runningContainer -eq $CONTAINER_NAME) {\n    Write-Host \"  ✓ Container is running\" -ForegroundColor Green\n} else {\n    Write-Host \"  ✗ Container is not running\" -ForegroundColor Red\n    Write-Host \"  Checking logs...\" -ForegroundColor Yellow\n    docker logs $CONTAINER_NAME 2>&1\n    exit 1\n}\n\n# Success!\nWrite-Host \"\"\nWrite-Host \"========================================\" -ForegroundColor Green\nWrite-Host \"✓ SK-Ana is ready!\" -ForegroundColor Green\nWrite-Host \"========================================\" -ForegroundColor Green\nWrite-Host \"\"\nWrite-Host \"Access the application at:\" -ForegroundColor Cyan\nWrite-Host \"  http://localhost:$PORT\" -ForegroundColor Yellow\nWrite-Host \"\"\nWrite-Host \"Useful commands:\" -ForegroundColor Cyan\nWrite-Host \"  View logs:     docker logs -f $CONTAINER_NAME\"\nWrite-Host \"  Stop:          docker stop $CONTAINER_NAME\"\nWrite-Host \"  Restart:       docker restart $CONTAINER_NAME\"\nWrite-Host \"  Remove:        docker rm $CONTAINER_NAME\"\nWrite-Host \"\"\nWrite-Host \"Note: The Correction Spectra feature is now available!\" -ForegroundColor Green\nWrite-Host \"\"\n"